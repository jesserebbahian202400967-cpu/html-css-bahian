<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Electric Bill Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>

 
 <nav class="navbar">

  <a href="profile.html">
    <img src="profile.png.webp" class="avatar" alt="User Icon">
  </a>

  <ul>
    <li><a href="dashboard.html">Dashboard</a></li>
    <li><a href="calculator.html">Calculator</a></li>
    <li><a href="history.html">History</a></li>
    <li><a href="login.html">Log out</a></li>
  </ul>

</nav>


  <section class="content">

    <div class="bill-box">
      <h3>Last Month Bill:</h3>
      <h1> </h1>
      <p>121.00kWh</p>
    </div>

    <div class="cards">

      <div class="card">
        <img src="calcu.png.png" class="card-img">
        <h2>Calculator</h2>
        <p>Calculate your electricity bill with instant results and detailed breakdown.</p>
      </div>

      <div class="card">
        <img src="monthly.png.png" class="card-img">
        <h2>Track Monthly Usage</h2>
      </div>

      <div class="card">
        <img src="records.png.png" class="card-img">
        <h2>Result</h2>
        <p>View your complete billing history with chartwise filtering and analytics.</p>
      </div>

    </div>

  </section>

  <!-- Load Supabase SDK, config and auth helpers -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="js/supabase-config.js"></script>
  <script src="js/auth-guard.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/database.js"></script>
  <script>
    requireAuth();
    
    // Ensure profile is created on dashboard load
    async function ensureProfileCreated() {
      try {
        console.log('ðŸ”„ Ensuring profile exists...');
        const user = await getCurrentUser();
        
        if (user && user.email) {
          const result = await createOrUpdateProfile(user.email);
          console.log('Profile sync result:', result);
        }
      } catch (error) {
        console.error('Error syncing profile:', error);
      }
    }
    
    // Load dashboard data
    async function loadDashboardData() {
      try {
        // First ensure profile exists
        await ensureProfileCreated();
        
        const lastBill = await getLastBillAmount();
        const lastKwh = await getLastKwhUsed();
        
        const billElement = document.querySelector('.bill-box h1');
        const kwhElement = document.querySelector('.bill-box p');
        
        if (billElement) {
          billElement.textContent = `â‚±${lastBill.toFixed(2)}`;
        }
        if (kwhElement) {
          kwhElement.textContent = `${lastKwh.toFixed(2)} kWh`;
        }
      } catch (error) {
        console.error('Error loading dashboard data:', error);
      }
    }
    
    document.addEventListener('DOMContentLoaded', loadDashboardData);
  </script>

  </body>
  </html>
